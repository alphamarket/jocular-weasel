<?php if(!isset($this->total_pages) || !isset($this->query)) throw new \zinux\kernel\exceptions\invalidArgumentException; ?>
<div style="margin-top: 30px;"></div>
 <?php foreach($this->query as $index => $disqus) : ?>
<div id="disqus-<?= $index ?>" style='margin: 10px; padding: 10px;'>
    <div style="border-bottom: 1px solid #eee">
        <h3 style="margin: 0"  dir="auto"><small class="fa fa-thumb-tack"></small> <a href="/disqus/view/<?= $disqus->disqusid ?>"><?= $disqus->title ?></a></h3>
        <?php if(@$disqus->tag_id): ?>
        <ol class="list-inline pull-left" style='margin:3px; margin-top: 10px'>
            <?php $tag = \modules\defaultModule\models\tag::find(@$disqus->tag_id)->tag_name; ?>
            <li class='active'><span class='fa fa-tag'></span> <a href='/tag/<?= $tag ?>'><?= $tag ?></a>
        </ol>
        <?php endif; ?>
        <small class="text-muted">
            <span class="updated-date pull-right" style="margin:3px; margin-top: 10px" data-date='<?= $disqus->updated_at ?>'></span>
            <span class="pull-right" style="margin:3px; margin-top: 10px">By <span style="border-bottom: 2px dotted #aaa"><?= $disqus->username ?></span></span>
            <span class="fa fa-pencil pull-right" style='margin:0px; margin-top: 12px'></span> 
        </small>
        <div class="clearfix"></div>
    </div>
    <div style="margin: 10px;" dir="auto">
        <?= substr(/*strip_tags*/($disqus->context), 0) ?>
    </div>
    <div class="clearfix" style="margin-top: 70px!important;"></div>
</div>
<?php endforeach; ?>
<?php if(!count($this->query)): ?>
<div style='border: 1px solid #eee; padding: 20px;' class='text-muted text-center'>
    Woow, No Disqus!!<br />You can always <a href='/disqus/new'>create</a> new disquses.
</div>
<?php endif; ?>
<?php $margin = 3; if($this->total_pages > 1) : ?>
<nav class="text-center">
  <ul class="pagination">
    <li>
      <a href="/page/<?=  max($this->current_page - 1, 1); ?>" aria-label="Previous">
        <span aria-hidden="true">&laquo;</span>
      </a>
    </li>
    <?php if(max($this->current_page - $margin, 1) != 1) : ?>
    <li><a href="/page/1">1</a></li>
    <li><a>...</a></li>
    <?php endif; ?>
    <?php for($i = max($this->current_page - $margin, 1); $i <= min($this->current_page + $margin, $this->total_pages); $i++) : ?>
    <li class="<?= $i == $this->current_page ? "active" : "" ?>"><a href="/page/<?= $i ?>"><?= $i ?></a></li>
    <?php endfor; ?>
    <?php if(min($this->current_page + $margin, $this->total_pages) != $this->total_pages) : ?>
    <li><a>...</a></li>
    <li><a href="/page/<?= $this->total_pages ?>"><?= $this->total_pages ?></a></li>
    <?php endif; ?>
    <li>
      <a href="/page/<?= min($this->current_page + 1, $this->total_pages) ?>" aria-label="Next">
        <span aria-hidden="true">&raquo;</span>
      </a>
    </li>
  </ul>
</nav>
<?php endif; ?>
<script type="text/javascript" src="/statics/js/moment.min.js"></script>
<script src="/statics/js/jquery.min.js" type="text/javascript"></script> 
<script type='text/javascript'>
    $(document).ready(function(){
        $(".updated-date[data-date]").each(function(index, elem) {
            $(this).html("<span class='fa fa-clock-o'></span> " + moment($(this).attr('data-date')).fromNow('ll') + " ago");
        });
    });
</script>
